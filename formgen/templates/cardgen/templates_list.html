<div class="space-y-3">
    {% for template in templates %}
        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
            <div class="flex justify-between items-start">
                <div class="flex-1">
                    <h4 class="font-medium text-gray-900 mb-1">{{ template.name }}</h4>
                    <p class="text-sm text-gray-500 mb-2">
                        Created: {{ template.created_at|date:"M d, Y" }}
                    </p>
                    <div class="flex flex-wrap gap-2">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            Card Template
                        </span>
                        {% if template.global_vars %}
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                Has Variables
                            </span>
                        {% endif %}
                    </div>
                </div>
                <div class="flex items-center space-x-2 ml-4">
                    <button onclick="editTemplate({{ template.id }})" 
                            class="px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                        Edit
                    </button>
                    <button onclick="generateCard({{ template.id }}, '{{ template.name }}')" 
                            class="px-3 py-1 text-sm bg-green-500 text-white rounded hover:bg-green-600 transition-colors">
                        Generate Card
                    </button>
                    <button onclick="deleteTemplate({{ template.id }}, '{{ template.name }}')" 
                            class="px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600 transition-colors">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="text-center py-8">
            <div class="text-gray-400 mb-4">
                <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                </svg>
            </div>
            <p class="text-gray-500 mb-4">No card templates found</p>
            <p class="text-sm text-gray-400">Create your first card template to get started</p>
        </div>
    {% endfor %}
</div>

<div class="mt-6 flex justify-center space-x-3">
    <button onclick="showCreateTemplateModal({{ org.id }})" 
            class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
        Create New Template
    </button>
    <button onclick="showImportTemplateModal({{ org.id }})" 
            class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">
        Import Template
    </button>
</div>

<script>
function editTemplate(templateId) {
    window.location.href = `/cardgen/editor/${templateId}/`;
}

function generateCard(templateId, templateName) {
    const cardName = prompt(`Enter a name for the card generated from "${templateName}":`);
    if (!cardName) return;
    
    fetch(`/cardgen/generate/${templateId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            name: cardName
        })
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Card generated successfully!');
            // Optionally redirect to view the generated card
        } else {
            alert('Error generating card: ' + result.error);
        }
    })
    .catch(error => {
        alert('Error generating card: ' + error.message);
    });
}

function deleteTemplate(templateId, templateName) {
    if (!confirm(`Are you sure you want to delete the template "${templateName}"? This action cannot be undone.`)) {
        return;
    }
    
    fetch(`/cardgen/delete/${templateId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Template deleted successfully!');
            // Reload the templates for the organization
            loadOrgTemplates(result.org_id);
        } else {
            alert('Error deleting template: ' + result.error);
        }
    })
    .catch(error => {
        alert('Error deleting template: ' + error.message);
    });
}
</script>
